!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=5)}([function(t,e,i){var n=i(1);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(3)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){(t.exports=i(2)(!1)).push([t.i,"body {\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\ncanvas {\r\n  margin: 50px;\r\n}\r\n",""])},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var s=(o=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),r=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[i].concat(r).concat([s]).join("\n")}var o;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var r=this[s][0];null!=r&&(n[r]=!0)}for(s=0;s<t.length;s++){var o=t[s];null!=o[0]&&n[o[0]]||(i&&!o[2]?o[2]=i:i&&(o[2]="("+o[2]+") and ("+i+")"),e.push(o))}},e}},function(t,e,i){var n,s,r={},o=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===s&&(s=n.apply(this,arguments)),s}),a=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var n=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),l=null,h=0,c=[],u=i(4);function f(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=r[n.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](n.parts[o]);for(;o<n.parts.length;o++)s.parts.push(w(n.parts[o],e))}else{var a=[];for(o=0;o<n.parts.length;o++)a.push(w(n.parts[o],e));r[n.id]={id:n.id,refs:1,parts:a}}}}function p(t,e){for(var i=[],n={},s=0;s<t.length;s++){var r=t[s],o=e.base?r[0]+e.base:r[0],a={css:r[1],media:r[2],sourceMap:r[3]};n[o]?n[o].parts.push(a):i.push(n[o]={id:o,parts:[a]})}return i}function d(t,e){var i=a(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=c[c.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),c.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=a(t.insertAt.before,i);i.insertBefore(e,s)}}function y(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=c.indexOf(t);e>=0&&c.splice(e,1)}function v(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return g(e,t.attrs),d(t,e),e}function g(t,e){Object.keys(e).forEach(function(i){t.setAttribute(i,e[i])})}function w(t,e){var i,n,s,r;if(e.transform&&t.css){if(!(r="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=r}if(e.singleton){var o=h++;i=l||(l=v(e)),n=x.bind(null,i,o,!1),s=x.bind(null,i,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",g(e,t.attrs),d(t,e),e}(e),n=function(t,e,i){var n=i.css,s=i.sourceMap,r=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||r)&&(n=u(n));s&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var o=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}.bind(null,i,e),s=function(){y(i),i.href&&URL.revokeObjectURL(i.href)}):(i=v(e),n=function(t,e){var i=e.css,n=e.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,i),s=function(){y(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=o()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=p(t,e);return f(i,e),function(t){for(var n=[],s=0;s<i.length;s++){var o=i[s];(a=r[o.id]).refs--,n.push(a)}t&&f(p(t,e),e);for(s=0;s<n.length;s++){var a;if(0===(a=n[s]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete r[a.id]}}}};var b,m=(b=[],function(t,e){return b[t]=e,b.filter(Boolean).join("\n")});function x(t,e,i,n){var s=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=m(e,s);else{var r=document.createTextNode(s),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(r,o[e]):t.appendChild(r)}}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,n=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var s,r=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?t:(s=0===r.indexOf("//")?r:0===r.indexOf("/")?i+r:n+r.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")})}},function(t,e,i){"use strict";i.r(e);i(0);function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(){function t(e,i,n,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=i,this.canvas=document.getElementById(e),this.canvas.width=n,this.canvas.height=s,this.w=n,this.h=s,this.ctx=this.canvas.getContext("2d"),window.document.title=i,this.setup(),this.oldTime=0}var e,i,s;return e=t,(i=[{key:"start",value:function(){requestAnimationFrame(this._loop.bind(this))}},{key:"setup",value:function(){}},{key:"_loop",value:function(t){var e=t-this.oldTime;this.loop(e),this.oldTime=t,requestAnimationFrame(this._loop.bind(this))}},{key:"loop",value:function(t){}}])&&n(e.prototype,i),s&&n(e,s),t}();function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var o=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.debug=i,this.keyDownActions={},this.keyUpActions={},this.addKeysListeners(),this.mouseDownAction=null,this.mouseUpAction=null,this.addMouseListeners(e)}var e,i,n;return e=t,(i=[{key:"addKeysListeners",value:function(){window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this))}},{key:"addKeyDownAction",value:function(t,e){this.keyDownActions[t]=e}},{key:"addKeyUpAction",value:function(t,e){this.keyUpActions[t]=e}},{key:"addKeysAction",value:function(t,e,i){this.addKeyDownAction(t,e),this.addKeyUpAction(t,i)}},{key:"onKeyDown",value:function(t){this.debug&&console.log("KEYDOWN",t.keyCode),void 0!==this.keyDownActions[t.keyCode]&&this.keyDownActions[t.keyCode]()}},{key:"onKeyUp",value:function(t){void 0!==this.keyUpActions[t.keyCode]&&this.keyUpActions[t.keyCode]()}},{key:"addMouseListeners",value:function(t){t.addEventListener("mousedown",this.onMouseDown.bind(this))}},{key:"addMouseDownAction",value:function(t){this.mouseDownAction=t}},{key:"onMouseDown",value:function(t){this.mouseDownAction&&this.mouseDownAction(t)}}])&&r(e.prototype,i),n&&r(e,n),t}();function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i}var e,i,n;return e=t,n=[{key:"fromAngle",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t(i*Math.cos(e),i*Math.sin(e))}}],(i=[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"distance",value:function(t){return Math.hypot(t.x-this.x,t.y-this.y)}},{key:"add",value:function(t){return this.x=this.x+t.x,this.y=this.y+t.y,this}},{key:"subtract",value:function(t){return this.x=this.x-t.x,this.y=this.y-t.y,this}},{key:"mult",value:function(t){return this.x=this.x*t,this.y=this.y*t,this}},{key:"normalize",value:function(){var t=this.mag;return 0!==t&&this.mult(1/t),this}},{key:"setMag",value:function(t){return this.normalize().mult(t),this}},{key:"constrain",value:function(t){return this.mag>t&&this.setMag(t),this}},{key:"mag",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"angle",get:function(){return Math.atan2(this.y,this.x)}}])&&a(e.prototype,i),n&&a(e,n),t}();function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=function(){function t(e,i,n,s,r,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=new l(e,i),this.initPos=new l(e,i),this.vel=l.fromAngle(n,s),this.damping=r,this.size=o,this.color=a,this.rota=2*Math.random()*Math.PI,this.rotaOffset=(Math.random()-.5)/5}var e,i,n;return e=t,(i=[{key:"update",value:function(){this.pos.add(this.vel),this.vel.mult(this.damping),this.rota+=this.rotaOffset}},{key:"draw",value:function(t){t.fillStyle=this.color,t.save(),t.translate(this.pos.x,this.pos.y),t.rotate(this.rota),t.fillRect(-this.size/2,-this.size,this.size,2*this.size),t.restore()}}])&&h(e.prototype,i),n&&h(e,n),t}();function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var f=function(){function t(e,i,n,s,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.particles=[];for(var a=0;a<10;a++){var l=n+(Math.random()-.5),h=s+(Math.random()-.5),u=0===a?"#0FF":"#999";this.particles[a]=new c(e,i,l,h,.95,r/2,u)}setTimeout(o,500)}var e,i,n;return e=t,(i=[{key:"draw",value:function(t){for(var e=0;e<this.particles.length;e++){var i=this.particles[e];i.update(),i.draw(t)}}}])&&u(e.prototype,i),n&&u(e,n),t}();function p(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var d=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.r=n,this.initialPos=new l(e,i),this.acceleration=new l(0,0),this.pos=new l(e,i),this.vel=new l(0,0),this.angle=0,this.shipAngleOffset=0,this.boost=0,this.explosion=null}var e,i,n;return e=t,(i=[{key:"startTurning",value:function(t){this.shipAngleOffset=t}},{key:"stopTurning",value:function(){this.shipAngleOffset=0}},{key:"startBoost",value:function(t){this.boost=t}},{key:"stopBoost",value:function(){this.boost=0}},{key:"resetPos",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.initialPos.x,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.initialPos.y;this.explosion=null,this.pos=new l(t,e),this.vel=new l(0,0),this.angle=0,this.shipAngleOffset=0,this.boost=0,this.enteringPortal=!1,this.acceleration=new l(0,0)}},{key:"update",value:function(t){if(!this.explosion){var e=this.angle+.001*this.shipAngleOffset*t;this.angle=e,this.angle<-Math.PI&&(this.angle+=2*Math.PI),this.angle>Math.PI&&(this.angle-=2*Math.PI),this.boost>0&&!this.enteringPortal?this.acceleration=l.fromAngle(this.angle,.001*this.boost*t):this.acceleration=new l(0,0),this.vel.add(this.acceleration),this.vel.constrain(.25*t),this.pos.add(this.vel),this.enteringPortal&&(this.r-=.1,this.r=Math.max(this.r,.1))}}},{key:"edges",value:function(t,e){return this.pos.x>t+this.r&&(this.pos.x=0),this.pos.y>e+this.r&&(this.pos.y=0),this.pos.x<-this.r&&(this.pos.x=t+this.r),this.pos.y<-this.r+this.r&&(this.pos.y=e+this.r),!1}},{key:"explode",value:function(t){if(!this.explosion){var e=this.vel.angle,i=this.vel.mag;this.explosion=new f(this.pos.x,this.pos.y,e,i,this.r,t)}}},{key:"enterPortal",value:function(t,e){if(!this.enteringPortal){this.enteringPortal=!0,this.portalCb=e,this.portalPos=t.pos;var i=this.pos.clone();i.subtract(t.pos),i.mult(-1),i.setMag(1),this.vel=i,setTimeout(e,500)}}},{key:"draw",value:function(t,e){this.explosion?this.explosion.draw(t):(e.draw(t,this),this._drawShip(t),this._drawBoost(t))}},{key:"_drawShip",value:function(t){t.save(),t.fillStyle="#999",t.translate(this.pos.x,this.pos.y),t.rotate(this.angle),t.beginPath(),t.ellipse(0,0,this.r,this.r,0,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),t.strokeStyle="#0FF",t.lineWidth=this.r/4;var e=.5*this.r;t.ellipse(0,0,e,e,0,-Math.PI/4,Math.PI/4),t.stroke(),t.closePath(),t.restore()}},{key:"_drawBoost",value:function(t){if(0!==this.boost){t.save(),t.translate(this.pos.x,this.pos.y),t.rotate(this.angle),t.fillStyle="#ff860d",t.beginPath(),t.moveTo(-this.r,-this.r/4*2),t.lineTo(-this.r-this.r/1.5*2,0),t.lineTo(-this.r,this.r/4*2),t.closePath(),t.fill(),t.restore()}}}])&&p(e.prototype,i),n&&p(e,n),t}();function y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var v=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.frontLightAngle=Math.PI/6,this.rays=[],this.points=[],this.rayLength=1e3,this.w=e,this.h=i,this.c2=document.createElement("canvas"),this.ctx2=this.c2.getContext("2d")}var e,i,n;return e=t,(i=[{key:"makeRays",value:function(t,e){var i=this,n=[],s=l.fromAngle(t.angle-this.frontLightAngle,this.rayLength),r=l.fromAngle(t.angle+this.frontLightAngle,this.rayLength);return n.push(s),n.push(r),e.edges.forEach(function(e){for(var s=0;s<2;s++){var r=e[s].x-t.pos.x,o=e[s].y-t.pos.y,a=new l(r,o),h=a.angle;if(t.angle<0&&h>Math.PI/2?h-=2*Math.PI:t.angle>0&&h<-Math.PI/2&&(h+=2*Math.PI),h>=t.angle-i.frontLightAngle&&h<=t.angle+i.frontLightAngle){a.setMag(i.rayLength),n.push(a);var c=l.fromAngle(a.angle-1e-4,i.rayLength),u=l.fromAngle(a.angle+1e-4,i.rayLength);n.push(c),n.push(u)}}}),n}},{key:"calculateRaysIntersection",value:function(t,e){var i=[];this.rays.forEach(function(n){var s=1/0,r=null;e.edges.forEach(function(e){var i=e[1].x-e[0].x,o=e[1].y-e[0].y;if(Math.abs(i-n.x)>0&&Math.abs(o-n.y)>0){var a=(n.x*(e[0].y-t.pos.y)+n.y*(t.pos.x-e[0].x))/(i*n.y-o*n.x),h=(e[0].x+i*a-t.pos.x)/n.x;h>0&&a>=0&&a<=1&&h<s&&(s=h,r=new l(n.x*h,n.y*h))}}),r&&i.push(r)});for(var n=[],s=0;s<i.length-1;s++){var r=i[s],o=i[s+1];Math.abs(r.x-o.x)<3&&Math.abs(r.y-o.y)<3||n.push(r)}return n.push(i[i.length-1]),i=(i=n).sort(function(e,i){var n=e.angle,s=i.angle;return(t.angle<-Math.PI/2||t.angle>Math.PI/2)&&(n<0&&(n+=2*Math.PI),s<0&&(s+=2*Math.PI)),n<s?-1:n>s?1:0})}},{key:"drawRays",value:function(t,e){var i=this;t.lineWidth=1,this.rays.forEach(function(n,s){t.beginPath(),t.strokeStyle="#F00";var r=n.angle;e.angle<0&&r>Math.PI/2&&(r-=2*Math.PI),e.angle>0&&r<-Math.PI/2&&(r+=2*Math.PI),r>=e.angle-i.frontLightAngle&&r<=e.angle+i.frontLightAngle&&(t.strokeStyle="#0F0"),t.moveTo(e.pos.x,e.pos.y),t.lineTo(e.pos.x+n.x,e.pos.y+n.y),t.stroke();var o=n.clone();o.setMag(60),o.add(e.pos),t.fillStyle="#FF0",t.beginPath(),t.ellipse(o.x,o.y,10,10,0,0,2*Math.PI),t.fill(),t.fillStyle="#00F",t.textAlign="center",t.textBaseline="middle",t.fillText(s,o.x,o.y)}),this.points.forEach(function(i,n){var s=i.clone();s.setMag(.9*s.mag);var r=s.x+e.pos.x,o=s.y+e.pos.y;t.fillStyle="#000",t.beginPath(),t.ellipse(r,o,6,6,0,0,2*Math.PI),t.fill(),t.fillStyle="#FFF",t.textAlign="center",t.textBaseline="middle",t.fillText(n,r,o)}),t.beginPath(),t.strokeStyle="rgba(255, 255, 0, 1)",t.lineWidth=2,t.moveTo(e.pos.x,e.pos.y);var n=e.pos.x+1e3*Math.cos(e.angle-this.frontLightAngle),s=e.pos.y+1e3*Math.sin(e.angle-this.frontLightAngle);t.lineTo(n,s),t.closePath(),t.stroke(),t.beginPath(),t.strokeStyle="rgba(255, 255, 0, 1)",t.lineWidth=2,t.moveTo(e.pos.x,e.pos.y),n=e.pos.x+1e3*Math.cos(e.angle+this.frontLightAngle),s=e.pos.y+1e3*Math.sin(e.angle+this.frontLightAngle),t.lineTo(n,s),t.closePath(),t.stroke()}},{key:"update",value:function(t,e){this.rays=this.makeRays(t,e),this.points=this.calculateRaysIntersection(t,e)}},{key:"draw",value:function(t,e){var i=this,n=e.pos.x+300*Math.cos(e.angle),s=e.pos.y+300*Math.sin(e.angle),r=t.createLinearGradient(e.pos.x,e.pos.y,n,s);r.addColorStop(0,"rgba(255, 255, 255, .5)"),r.addColorStop(1,"rgba(255, 255, 255, 0.0)");var o=e.pos.x+150*Math.cos(e.angle-this.frontLightAngle),a=e.pos.y+150*Math.sin(e.angle-this.frontLightAngle),l=e.pos.x+150*Math.cos(e.angle+this.frontLightAngle),h=e.pos.y+150*Math.sin(e.angle+this.frontLightAngle),c=t.createLinearGradient(o,a,l,h);c.addColorStop(0,"rgba(255, 255, 255, 0)"),c.addColorStop(.5,"rgba(255, 255, 255, 1)"),c.addColorStop(1,"rgba(255, 255, 255, 0)"),this.points.length>0&&(this.c2.width=this.w,this.c2.height=this.h,this.ctx2.beginPath(),this.ctx2.fillStyle=r,this.ctx2.moveTo(e.pos.x,e.pos.y),this.points.forEach(function(t){i.ctx2.lineTo(e.pos.x+t.x,e.pos.y+t.y)}),this.ctx2.closePath(),this.ctx2.fill(),this.ctx2.globalCompositeOperation="source-in",this.ctx2.beginPath(),this.ctx2.fillStyle=c,this.ctx2.moveTo(e.pos.x,e.pos.y),this.points.forEach(function(t){i.ctx2.lineTo(e.pos.x+t.x,e.pos.y+t.y)}),this.ctx2.closePath(),this.ctx2.fill()),t.drawImage(this.c2,0,0)}}])&&y(e.prototype,i),n&&y(e,n),t}();function g(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var w=function(){function t(e,i,n,s,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.i=e,this.j=i,this.cellW=n,this.cellH=s,this.index=r,this.walls={n:!0,e:!0,s:!0,w:!0},this.visited=!1}var e,i,n;return e=t,(i=[{key:"collides",value:function(t){var e=t.pos,i=e.x,n=e.y,s=t.r,r=this.i*this.cellW,o=this.j*this.cellH;return!!(i+s>r&&i-s<r+this.cellW&&n+s>o&&n-s<o+this.cellH)&&(this.walls.e&&i+s>r+this.cellW||this.walls.w&&i-s<r||this.walls.s&&n+s>o+this.cellH||this.walls.n&&n-s<o)}},{key:"draw",value:function(t){var e=this.i*this.cellW,i=this.j*this.cellH;t.strokeStyle="#FFF",t.lineWidth=2,this.walls.n&&this._drawWall(t,e,i,e+this.cellW,i),this.walls.e&&this._drawWall(t,e+this.cellW,i,e+this.cellW,i+this.cellH),this.walls.s&&this._drawWall(t,e+this.cellW,i+this.cellH,e,i+this.cellH),this.walls.w&&this._drawWall(t,e,i+this.cellH,e,i)}},{key:"_drawWall",value:function(t,e,i,n,s){t.beginPath(),t.moveTo(e,i),t.lineTo(n,s),t.stroke(),t.closePath()}}])&&g(e.prototype,i),n&&g(e,n),t}();function b(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var m=function(){function t(e,i,n,s){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cols=e,this.rows=i,this.cellW=n,this.cellH=s,this.grid=[],this.stack=[],this.longestStack=0,this.furthestCellCoords=null;for(var o=0,a=0;a<i;a++)for(var l=0;l<e;l++){var h=new w(l,a,n,s,o);this.grid.push(h),o++}this.current=this.grid[0];for(var c=!1;!c;)c=this.nextBuildStep();console.log(this.grid),this.edges=[],this.grid.forEach(function(t){t.walls.n&&r._addEdge(t,0,0,1,0),t.walls.s&&r._addEdge(t,0,1,1,1),t.walls.w&&r._addEdge(t,0,0,0,1),t.walls.e&&r._addEdge(t,1,0,1,1)});var u=this.edges.filter(function(t,e){var i=!0;return r.edges.forEach(function(n,s){e<s&&t[0].x===n[0].x&&t[0].y===n[0].y&&t[1].y===n[1].y&&t[1].y===n[1].y&&(i=!1)}),i});this.edges=u}var e,i,n;return e=t,(i=[{key:"_addEdge",value:function(t,e,i,n,s){var r=t.i+e,o=t.j+i,a=t.i+n,h=t.j+s;this.edges.push([new l(r*this.cellW,o*this.cellH),new l(a*this.cellW,h*this.cellH)])}},{key:"checkNeighbors",value:function(){var t=this.current,e=t.i,i=t.j,n=[],s=this.grid[this.index(e,i-1)],r=this.grid[this.index(e+1,i)],o=this.grid[this.index(e,i+1)],a=this.grid[this.index(e-1,i)];return s&&!s.visited&&n.push(s),r&&!r.visited&&n.push(r),o&&!o.visited&&n.push(o),a&&!a.visited&&n.push(a),n.length>0?n[Math.floor(Math.random()*n.length)]:void 0}},{key:"index",value:function(t,e){return t<0||e<0||t>this.cols-1||e>this.rows-1?-1:t+e*this.cols}},{key:"removeWalls",value:function(t,e){var i=t.i-e.i;1===i?(t.walls.w=!1,e.walls.e=!1):-1===i&&(t.walls.e=!1,e.walls.w=!1);var n=t.j-e.j;1===n?(t.walls.n=!1,e.walls.s=!1):-1===n&&(t.walls.s=!1,e.walls.n=!1)}},{key:"nextBuildStep",value:function(){this.current.visited=!0;var t=this.checkNeighbors(this.current.i,this.current.j);return t?(t.visited=!0,this.stack.push(this.current),this.removeWalls(this.current,t),this.current=t):this.stack.length>0&&(this.stack.length>this.longestStack&&(this.longestStack=this.stack.length,this.furthestCellCoords={i:this.current.i,j:this.current.j}),this.current=this.stack.pop()),0===this.stack.length}},{key:"collides",value:function(t){for(var e=0;e<this.grid.length;e++){if(this.grid[e].collides(t))return!0}return!1}},{key:"draw",value:function(t){for(var e=0;e<this.grid.length;e++)this.grid[e].draw(t)}},{key:"_drawEdges",value:function(t){this.edges.forEach(function(e){t.beginPath(),t.fillStyle="#F00",t.ellipse(e[0].x,e[0].y,5,5,0,0,2*Math.PI),t.fill(),t.beginPath(),t.fillStyle="#00F",t.ellipse(e[1].x,e[1].y,5,5,0,0,2*Math.PI),t.fill(),t.beginPath(),t.strokeStyle="#0F0",t.lineWidth=2,t.moveTo(e[0].x,e[0].y),t.lineTo(e[1].x,e[1].y),t.stroke()})}}])&&b(e.prototype,i),n&&b(e,n),t}();function x(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var k=function(){function t(e,i,n,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pos=new l(e,i),this.innerRadius=.7*n,this.strokeWidth=n-this.innerRadius,this.r=this.innerRadius+this.strokeWidth/2,this.angle=0,this.isColliding=!1,this.isLastLevel=s}var e,i,n;return e=t,(i=[{key:"collides",value:function(t){var e=this.pos.distance(t.pos)<this.innerRadius+t.r;return this.isColliding=!!e&&t.pos,e}},{key:"draw",value:function(t){t.strokeStyle="#aaa",t.lineWidth=this.strokeWidth,t.save(),t.translate(this.pos.x,this.pos.y);var e,i,n,s,r,o=(e=Math.sin(performance.now()/500),i=-1,n=1,s=2,r=this.r-this.r/2,(e-i)*(r-s)/(n-i)+s),a=t.createRadialGradient(0,0,o,0,0,this.r);a.addColorStop(0,this.isLastLevel?"#ed7a7d":"#a9f3fa"),a.addColorStop(1,this.isLastLevel?"#bb2027":"#0aaba7"),t.fillStyle=a,t.beginPath(),t.ellipse(0,0,this.r,this.r,0,0,2*Math.PI),t.fill(),t.stroke(),t.restore()}}])&&x(e.prototype,i),n&&x(e,n),t}();function P(t){return(P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function M(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function A(t,e){return!e||"object"!==P(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function L(t,e){return(L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var T=8,j=10,C=!1,O=!0,E=!0,I=8,_=0,F=1,R=2,U=3,W=4;new(function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),A(this,S(e).apply(this,arguments))}var i,n,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L(t,e)}(e,s),i=e,(n=[{key:"setup",value:function(){var t=this;this.level=1,this.gameState=_,this.nextGameState=this.gameState,this.newLevel();var e=new o(this.canvas,C);e.addKeysAction(37,function(){return t.ship.startTurning(-T)},function(){return t.ship.stopTurning()}),e.addKeysAction(39,function(){return t.ship.startTurning(T)},function(){return t.ship.stopTurning()}),e.addKeysAction(38,function(){t.gameState===F&&t.ship.startBoost(j)},function(){return t.ship.stopBoost()}),C&&(e.addKeyDownAction(82,function(){return t.ship.resetPos()}),e.addKeyDownAction(65,function(){t.ship.angle+=Math.PI/4}),e.addKeyDownAction(66,function(){t.ship.vel=new l})),e.addKeyDownAction(32,function(){switch(t.gameState){case _:t.nextGameState=F;break;case F:t.nextGameState=R;break;case R:t.nextGameState=F;break;case U:case W:t.nextGameState=F,t.level=1,t.newLevel()}}),e.addMouseDownAction(function(e){return t.ship.resetPos(e.offsetX,e.offsetY)})}},{key:"newLevel",value:function(){var t=this.level+2,e=this.w/t,i=e,n=Math.ceil(this.h/i);i=this.h/n,this.maze=new m(t,n,e,i);var s=this.maze.furthestCellCoords.i*e+e/2,r=this.maze.furthestCellCoords.j*i+i/2,o=Math.min(e,i),a=I===this.level;this.portal=new k(s,r,o/2.5,a),this.shipFrontLight=new v(this.w,this.h),this.ship=new d(e/2,i/2,10)}},{key:"_writeText",value:function(t){this.ctx.fillStyle="#FFF",this.ctx.fillRect(0,this.h/2-15,this.w,30),this.ctx.fillStyle="#000",this.ctx.font="18px sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t,this.w/2,this.h/2)}},{key:"loop",value:function(t){var e=this;this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.w,this.h),this.maze.draw(this.ctx),this.portal.draw(this.ctx),this.ship.draw(this.ctx,this.shipFrontLight);var i="Level: ".concat(this.level);switch(this.ctx.font="12px sans-serif",this.ctx.fillStyle="#FFF",this.ctx.textAlign="left",this.ctx.fillText(i,15,15),this.gameState){case F:this.ship.update(t),this.shipFrontLight.update(this.ship,this.maze);var n=O?this.maze.collides(this.ship):this.ship.edges(this.w,this.h),s=!!E&&this.portal.collides(this.ship);n&&this.ship.explode(function(){e.ship.resetPos()}),s&&this.ship.enterPortal(this.portal,function(){e.level+1>I?e.nextGameState=U:(e.nextGameState=_,e.level+=1,e.newLevel())});break;case _:this._writeText('Appuyer sur "espace" pour commencer');break;case R:this._writeText('Appuyer sur "espace" pour reprendre');break;case U:this._writeText('Gagné ! Appuyer sur "espace" pour recommencer');break;case W:this._writeText('Perdu ! Appuyer sur "espace" pour recommencer')}this.gameState=this.nextGameState}}])&&M(i.prototype,n),r&&M(i,r),e}())("canvas","Space Maze",600,300).start()}]);
//# sourceMappingURL=bundle.js.map